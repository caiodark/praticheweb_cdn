{"version":3,"sources":["webpack:///./src/app/home/home.module.ts","webpack:///./src/app/home/home.page.html","webpack:///./src/app/home/home.page.scss","webpack:///./src/app/home/home.page.ts","webpack:///./src/app/services/casualty.service.ts"],"names":[],"mappings":"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","file":"home-home-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { NiceDateModule } from 'src/app/pipes/nice-date.module';\n\nimport { HomePage } from './home.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    NiceDateModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        component: HomePage\n      }\n    ])\n  ],\n  declarations: [HomePage]\n})\nexport class HomePageModule {}\n","module.exports = \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button icon-only menuToggle=\\\"start\\\">\\n        <ion-icon name=\\\"menu\\\"></ion-icon>\\n      </ion-menu-button>          \\n    </ion-buttons>\\n    <ion-title>\\n      Pratiche Web\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <div class=\\\"ion-padding\\\">\\n    <h1>Infortuni</h1>\\n    <div *ngIf=\\\"!baseCasualties || baseCasualties.length === 0\\\">\\n      Nessun infortunio presente. <br />\\n      <ion-button color=\\\"tertiary\\\" size=\\\"default\\\" (click)=\\\"onCreateClick()\\\">\\n        <ion-icon slot=\\\"icon-only\\\" name=\\\"create\\\"></ion-icon>\\n      </ion-button>\\n    </div>\\n    <div *ngIf=\\\"baseCasualties && baseCasualties.length > 0\\\">\\n      <ion-grid>\\n        <ion-row>\\n          <ion-col size=\\\"12\\\" size-sm>\\n            <ion-item lines=\\\"none\\\">\\n              <ion-button color=\\\"tertiary\\\" (click)=\\\"onCreateClick()\\\" size=\\\"default\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"create\\\"></ion-icon>\\n              </ion-button>\\n            </ion-item>\\n          </ion-col>\\n        </ion-row>\\n        <ion-row>\\n          <ion-col size=\\\"12\\\" size-sm>\\n              <ion-item lines=\\\"none\\\">                \\n                <ion-searchbar placeholder=\\\"Cerca\\\" (ionChange)=\\\"searchChange($event)\\\"></ion-searchbar>\\n                <ion-spinner *ngIf=\\\"!hideSpinner\\\"></ion-spinner>\\n              </ion-item>\\n            </ion-col>\\n          </ion-row>\\n      </ion-grid>\\n    </div>\\n    <ion-grid *ngIf=\\\"casualties && casualties.length > 0\\\">\\n      <ion-row>\\n        <ion-col size=\\\"12\\\" size-sm>\\n          <ion-virtual-scroll [items]=\\\"casualties\\\">\\n            <ion-item *virtualItem=\\\"let c\\\" lines=\\\"full\\\" approxItemHeight=\\\"57px\\\">\\n              <ion-button color=\\\"primary\\\" (click)=\\\"onItemClick(c.casualty.token)\\\" slot=\\\"start\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"compass\\\"></ion-icon>\\n              </ion-button>\\n              <ion-note slot=\\\"end\\\" class=\\\"ion-hide-sm-down\\\">\\n                {{c.customer ? c.customer.firstName : ''}} {{c.customer ? c.customer.lastName : ''}}\\n              </ion-note>\\n              <ion-button color=\\\"danger\\\" slot=\\\"end\\\" (click)=\\\"onItemDelete(c.casualty.token)\\\">\\n                <ion-icon slot=\\\"icon-only\\\" name=\\\"trash\\\"></ion-icon>\\n              </ion-button>\\n              <ion-label text-wrap>\\n                <span class=\\\"ion-hide-sm-down\\\">\\n                    {{c.casualty.casualtyDate | niceDate:'DD/MM/YYYY'}} {{c.casualty.place}}\\n                </span>\\n                <span class=\\\"ion-hide-md-up\\\">\\n                    {{c.casualty.casualtyDate | niceDate:'DD/MM/YYYY'}} {{c.customer ? c.customer.firstName : ''}} {{c.customer ? c.customer.lastName : ''}}\\n                </span>\\n              </ion-label>\\n            </ion-item>            \\n          </ion-virtual-scroll>\\n        </ion-col>\\n      </ion-row>\\n    </ion-grid>\\n  </div>\\n</ion-content>\\n\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2hvbWUvaG9tZS5wYWdlLnNjc3MifQ== */\"","import { Component, Input, OnDestroy } from '@angular/core';\nimport { Casualty } from 'src/app/models/casualty';\nimport { Customer } from 'src/app/models/customer';\nimport { CasualtyItem } from 'src/app/models/casualty-item';\nimport { Router, NavigationEnd } from '@angular/router';\nimport { CasualtyService } from 'src/app/services/casualty.service';\nimport { CustomerService } from 'src/app/services/customer.service';\nimport { AlertController, ToastController } from '@ionic/angular';\nimport { Subscription } from 'rxjs';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: 'home.page.html',\n  styleUrls: ['home.page.scss'],\n})\nexport class HomePage implements OnDestroy {\n  @Input() baseCasualties: CasualtyItem[] = [];\n  @Input() casualties: CasualtyItem[] = [];\n  hideSpinner = true;\n  @Input() query: string;\n  sub$: Subscription;\n\n  constructor(\n    private r: Router,\n    private tc: ToastController,\n    private ac: AlertController,\n    private cas: CasualtyService,\n    private cs: CustomerService,\n  ) {\n    this.sub$ = this.r.events.subscribe((e: any) => {\n      if (e instanceof NavigationEnd) {\n        this.loadData();\n      }\n    });\n  }\n  private getList(): Promise<Casualty[]> {\n    const self = this;\n    return new Promise((resolve, reject) => {\n      this.cas.getList().subscribe({\n        next(ris) {\n          resolve(ris);\n        },\n        error(err) {\n          reject(err);\n        }\n      });\n    });\n  }\n\n  private getCustomers(): Promise<Customer[]> {\n    return new Promise((resolve, reject) => {\n      this.cs.asyncGetCustomers().subscribe(cs => resolve(cs));\n    });\n  }\n\n  private mapToItem(cas: Casualty[], cs: Customer[]): CasualtyItem[] {\n    return cas.map(c => {\n      const mayCustomer = cs.filter(cus => cus.token === c.customerId);\n      return {\n        casualty: c,\n        customer: mayCustomer ? mayCustomer[0] : null\n      };\n    });\n  }\n\n  private async loadData() {\n    try {\n      // console.log('entrato');\n      const cas = await this.getList();\n      const cs = await this.getCustomers();\n      this.casualties = this.mapToItem(cas, cs);\n      this.baseCasualties = this.casualties;\n      if (this.query) {\n        this.casualties = await this.filterData(this.query);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  onCreateClick() {\n    this.r.navigate(['casualty', 'new']);\n  }\n\n  async ionViewWillEnter() {\n    this.loadData();\n  }\n\n  private filterData(query: string): Promise<Array<CasualtyItem>> {\n    const self = this;\n    return new Promise ((resolve, reject) => {\n      if (query && query !== '') {\n        try {\n          resolve(this.baseCasualties.filter(obj => {\n            const srep = JSON.stringify(obj);\n            const regex = new RegExp(`${query}`, 'i');\n            return regex.test(srep);\n          }));\n        } catch (e) {\n          resolve(this.baseCasualties);\n        }\n      } else {\n        resolve(this.baseCasualties);\n      }\n    });\n  }\n\n  async searchChange(event) {\n    this.query = event.target.value;\n    this.casualties = await this.filterData(event.target.value);\n  }\n\n  onItemClick(token: string) {\n    this.r.navigate(['casualty', token]);\n  }\n\n  private DeleteItem(token: string): Promise<boolean> {\n    const self = this;\n    return new Promise((resolve, reject) => {\n      self.cas.delete(token).subscribe({\n        next(ris) {\n          resolve(ris);\n        },\n        error(err) {\n          reject(err);\n        }\n      });\n    });\n  }\n\n  private async ShowMessage(message: string) {\n    const toast = await this.tc.create({\n      message,\n      duration: 2000\n    });\n    await toast.present();\n  }\n\n  private async ConfirmDelete(token: string) {\n    const self = this;\n    const alert = await this.ac.create({\n      header: 'Cancellazione infortunio',\n      message: 'Stai per <strong>cancellare</strong> un infortunio',\n      buttons: [\n        {\n          text: 'Annulla',\n          role: 'cancel',\n          cssClass: 'secondary',\n          handler: (cnl) => {}\n        },\n        {\n          text: 'Conferma',\n          handler: () => {\n            try {\n              this.DeleteItem(token).then(ss => {\n                if (ss) {\n                  this.r.navigate(['home']);\n                  self.ShowMessage('Infortunio correttamente cancellato.');\n                } else {\n                  self.ShowMessage('Si è verificato un problema. Riprova!');\n                }\n              });\n            } catch (e) {\n              self.ShowMessage(`Si è verificato un problema ${e}. Riprova!`);\n            }\n          }\n        }\n      ]\n    });\n    await alert.present();\n  }\n\n  async onItemDelete(token: string) {\n    await this.ConfirmDelete(token);\n  }\n\n  ngOnDestroy() {\n    if (this.sub$) {\n      this.sub$.unsubscribe();\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpResponse } from '@angular/common/http';\nimport { Casualty } from '../models/casualty';\nimport { Observable } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CasualtyService {\n  baseUrl = '/api/casualties';\n  constructor(private hc: HttpClient) { }\n\n  getList(kind?: string): Observable<Casualty[]> {\n    let session = window.localStorage.getItem('_session');\n    if (! session) {\n      session = 'loggedout';\n    }\n    return this.hc.get<Casualty[]>(`${this.baseUrl}`, {\n      headers : {\n        's-t': session\n      }\n    });\n  }\n\n  single(token: string): Observable<Casualty> {\n    let session = window.localStorage.getItem('_session');\n    if (! session) {\n      session = 'loggedou';\n    }\n    return this.hc.get<Casualty>(`${this.baseUrl}/${token}`, {\n      headers: {\n        's-t': session\n      }\n    });\n  }\n  saveNew(casualty: Casualty): Observable<Casualty> {\n    let session = window.localStorage.getItem('_session');\n    if (! session) {\n      session = 'loggedou';\n    }\n    return this.hc.post<Casualty>(this.baseUrl, casualty, {\n      headers: {\n        's-t': session\n      }\n    });\n  }\n\n  update(casualty: Casualty): Observable<Casualty> {\n    let session = window.localStorage.getItem('_session');\n    if (! session) {\n      session = 'loggedou';\n    }\n    return this.hc.put<Casualty>(`${this.baseUrl}/${casualty.token}`, casualty, {\n      headers: {\n        's-t': session\n      }\n    });\n  }\n\n  delete(token: string): Observable<boolean> {\n    return new Observable((observer) => {\n      let session = window.localStorage.getItem('_session');\n      if (! session) {\n        session = 'loggedout';\n      }\n      this.hc.delete(`${this.baseUrl}/${token}`, {\n        headers: {\n          's-t': session\n        },\n        observe: 'response',\n        responseType: 'text',\n      }).subscribe((res: HttpResponse<any>) => {\n        observer.next(res.status === 200);\n      }, error => {\n        observer.error(error);\n      });\n    });\n  }\n\n}\n"],"sourceRoot":""}